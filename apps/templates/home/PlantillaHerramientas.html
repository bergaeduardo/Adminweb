{% extends "layouts/base.html" %}
{% load has_group %} <!-- \apps\home\templatetags\has_group.py -->

{% block title %} {{Nombre}} {% endblock %} 

<!-- Element injected in the BODY element -->
{% block body_class %} sidebar-mini sidebar-collapse {% endblock body_class %} 

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="/static/assets/plugins/fontawesome-free/css/all.min.css">
  <!-- overlayScrollbars -->
  <link rel="stylesheet" href="/static/assets/plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="/static/assets/css/adminlte.min.css">

{% endblock stylesheets %}

{% block content %}
{% with user_groups=request.user|get_user_groups %}  

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1 class="m-0 text-dark">{{Nombre}}</h1>
          </div><!-- /.col -->
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
              <li class="breadcrumb-item"><a href="/">Home</a></li>
              <li class="breadcrumb-item active">{{Nombre}}</li>
            </ol>
          </div><!-- /.col -->
        </div><!-- /.row -->
      </div><!-- /.container-fluid -->
    </div>
    <section class="content">
      <div class="container-fluid">
        
        <div style="position: relative; border: 1px solid #ddd; border-radius: .25rem; padding: 1rem; margin-top: 10px;">
          {% if request.user|has_any_group:"admin" %}
          <a href="javascript:void(0);" id="info-icon" title="Mostrar Información" style="position: absolute; top: 10px; left: 10px; z-index: 1000; font-size: 1.5rem; color: #6c757d;">
            <i class="fas fa-info-circle"></i>
          </a>

          <div id="popup-info" style="display: none; position: absolute; top: 40px; left: 10px; background-color: white; border: 1px solid #ccc; padding: 15px; z-index: 1001; box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-radius: 5px; min-width: 800px;">
            <p style="margin-bottom: 10px; font-weight: bold;">URL del Contenido:</p>
            <div style="display: flex; align-items: center; background-color: #f1f1f1; padding: 8px; border-radius: 4px;">
              <input type="text" id="iframe-url-text" value="{{dir_iframe}}" readonly style="border: none; background: transparent; width: 100%; outline: none; margin-right: 10px; font-family: monospace;">
              <button id="copy-button" title="Copiar al portapapeles" style="border: none; background: none; cursor: pointer; font-size: 1.2rem; padding: 0 5px;">
                <i class="far fa-copy"></i>
              </button>
            </div>
            <div id="copy-feedback" style="margin-top: 8px; color: green; font-size: 0.9em; text-align: right; display: none;">
              ¡URL copiada!
            </div>
          </div>
          {% endif %}
          <div id="iframe-wrapper">
            </div>

          <noscript>
            <div style="width: 100%; text-align: center; padding: 20px;">
              <p>Para ver este contenido, por favor habilite JavaScript.</p>
              <iframe frameborder="0" src="{{dir_iframe}}" width="1200" height="700"></iframe>
            </div>
          </noscript>
        </div>
        
      </div></section>
{% endwith %}
    <script>
      // Lógica para crear el Iframe con tamaño dinámico
      (function() {
        var largo, ancho;
        // Se ajusta la altura para compensar el nuevo marco (padding).
        // Puedes ajustar el valor '120' si necesitas más o menos espacio.
        var alturaOffset = 120; 

        if (window.innerHeight) {
           largo = window.innerHeight - alturaOffset;
           ancho = '100%';
        } else if (document.body.clientHeight) {
           largo = document.body.clientHeight - alturaOffset;
           ancho = '100%';
        } else {
           largo = 700; // Altura por defecto
           ancho = '100%'; // Ancho responsivo
        }
        
        var iframeWrapper = document.getElementById('iframe-wrapper');
        if (iframeWrapper) {
          iframeWrapper.innerHTML = '<iframe frameborder="0" src="{{dir_iframe}}" width="' + ancho + '" height="' + largo + '" style="display: block; border: none;"></iframe>';
        }
      })();

      // Lógica para el Popup y el botón de copiar
      (function() {
        var infoIcon = document.getElementById('info-icon');
        var popup = document.getElementById('popup-info');
        var copyButton = document.getElementById('copy-button');
        var urlTextInput = document.getElementById('iframe-url-text');
        var copyFeedback = document.getElementById('copy-feedback');

        // Mostrar/ocultar el popup al hacer clic en el ícono de información
        if (infoIcon && popup) {
          infoIcon.addEventListener('click', function(event) {
            event.preventDefault();
            popup.style.display = (popup.style.display === 'none' || popup.style.display === '') ? 'block' : 'none';
          });
        }

        // Copiar la URL al portapapeles al hacer clic en el botón de copiar
        if (copyButton && urlTextInput) {
          copyButton.addEventListener('click', function() {
            navigator.clipboard.writeText(urlTextInput.value).then(function() {
              copyFeedback.style.display = 'block';
              setTimeout(function() {
                copyFeedback.style.display = 'none';
              }, 2500); // Ocultar mensaje después de 2.5 segundos
            }).catch(function(err) {
              console.error('Error al intentar copiar la URL: ', err);
              alert('No se pudo copiar la URL. Inténtelo manualmente.');
            });
          });
        }

        // Opcional: Cerrar el popup si el usuario hace clic fuera de él
        document.addEventListener('click', function(event) {
          if (popup && !popup.contains(event.target) && !infoIcon.contains(event.target)) {
            popup.style.display = 'none';
          }
        });
      })();
    </script>
  </div>
  <!-- /.content-wrapper -->

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}

  <!-- REQUIRED SCRIPTS -->
  <!-- jQuery -->
  <script src="/static/assets/plugins/jquery/jquery.min.js"></script>
  <!-- Bootstrap -->
  <script src="/static/assets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
  <!-- overlayScrollbars -->
  <script src="/static/assets/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
  <!-- AdminLTE App -->
  <script src="/static/assets/js/adminlte.js"></script>

  <!-- OPTIONAL SCRIPTS -->
  <script src="/static/assets/js/demo.js"></script>

  <!-- PAGE PLUGINS -->
  <!-- jQuery Mapael -->
  <script src="/static/assets/plugins/jquery-mousewheel/jquery.mousewheel.js"></script>
  <script src="/static/assets/plugins/raphael/raphael.min.js"></script>
  <script src="/static/assets/plugins/jquery-mapael/jquery.mapael.min.js"></script>
  <script src="/static/assets/plugins/jquery-mapael/maps/usa_states.min.js"></script>
  <!-- ChartJS -->
  <script src="/static/assets/plugins/chart.js/Chart.min.js"></script>

  <!-- PAGE SCRIPTS -->
  <script src="/static/assets/js/pages/dashboard2.js"></script>

{% endblock javascripts %}